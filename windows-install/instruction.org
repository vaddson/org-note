#+title: Установка Emacs и Org-Note на Windows
#+language: ru
#+LATEX_HEADER: \usepackage{fontspec}
#+LATEX_HEADER: \setmainfont{Times New Roman}
#+LATEX_HEADER: \setmonofont{Cascadia Code}
#+latex_compiler: xelatex
 
* Подготовка к установке

** Зависимости

   Чтобы в полной мере наслаждаться возможностями org-note, нам
   понадобятся:
   + Текстовый редактор Emacs
   + Компилятор языка С
   + Проверяльщик орфографии Hunspell
   + Python 3
   + git

*** Устанавливаем Git и компиляторы

**** Msys2

     Первым делом, устанавливаем [[https://www.msys2.org/][msys2]]. Очень важно внимательно
     прочитать инструкцию. Пробелы, кириллица и специальные символы в
     пути установки не поддерживаются.

     Коротко инструкция:
     + Скачиваем и запускаем установщик
     + Выбираем путь установки. Только латинница, без пробелов и специальных символов. Чем короче путь, тем лучше
       #+ATTR_LATEX: :width 1\linewidth
       [[./screenshots/msys2-installation.png]]
     + Остальные настройки Выбираем На Свой Вкус

**** Установка необходимых программ.

     Запускаем msys2 msys (или выбираем "запустить msys2" в процессе
     установки) и видим страшненькое окошко терминала. Если git или
     Python 3 уже установлены в системе, достаточно установить только
     ~gcc~. Синтаксис команды установки: ~pacman -S <package>~

     Выполняем установку нужных нам зависимостей.
     #+name: установка git, pyhton, gcc
     #+begin_src bash
pacman -S git python3 gcc
     #+end_src
     Терминал покажет что именно он установит и спросит
     подтверждения. Достаточно нажать ~Enter~ и дождаться окончания
     установки.

     Не закрываем окно терминала. Оно нам ещё пригодится.

*** Устанавливаем Hunspell

    Короткий путь даст не самую свежую (но рабочую) версию. Длинные
    пути дадут нам свежую версию, но потребуют установить больше
    компиляторов или дополнительных пакетных менеджеров от Microsoft.

    Два длинных пути пока ещё неизведанны и в эту инструкцию не
    включены.
    1. Заходим на страницу [[https://sourceforge.net/projects/ezwinports/files/][EZWinPorts]] и находим там нужный нам файл -
       ~hunspell-<version>.bin.zip~. Скачиваем и распаковываем в
       удобное место.
    2. Запоминаем удобное место.

*** Добавляем установленное в переменные окружения.

	Для того, чтобы пользоваться установленными зависимостями
	необходимо сделать так, чтобы Windows могла их найти.

	Открываем меню "Пуск" или поиск и ищем "Переменные окружения"
	(если язык системы английский - "Environment Variables").
	#+ATTR_LATEX: :scale 1
	[[./screenshots/env-00.png]]

	Находим внизу открывшегося окна кнопку "Переменные окружения".
	#+ATTR_LATEX: :scale 1
	[[./screenshots/env-01.png]]

	Среди пользовательских переменных находим PATH, выбираем, нажимаем
	кнопку "Редактировать" ("Edit")
	#+ATTR_LATEX: :scale 1
	[[./screenshots/env-02.png]]

	Нажимаем "New" (Не знаю как это в переводе). Вставляем путь до
	исполняемых файлов msys2 и hunspell.

	Например, я установил msys2 по пути ~C:\msys64~ и распаковал
	Hunspell по пути ~C:\hunspell~.
	#+ATTR_LATEX: :scale 1
	[[./screenshots/env-03.png]]

	В переменные окружения я добавляю ~C:\hunspell\bin~ и ~C:\msys64\usr\bin~.
	#+ATTR_LATEX: :scale 1
	[[./screenshots/env-04.png]]

	Жмём "ОК", пока окна системных настроек не закроются.

** Устанавливаем Emacs.

   [[https://www.gnu.org/software/emacs/download.html#nonfree][Сайт Emacs]] говорит нам что очень легко поставить редактор через
   msys2. Мы этого делать не будем, потому что поставить легко, а вот
   пользоваться потом очень неудобно. Мы скачаем свежайший установщик
   с [[http://ftpmirror.gnu.org/emacs/windows][зеркала]]. Переходим по ссылке, выбираем свежайшую версию и
   скачиваем файл ~emacs-<версия>-installer.exe~. Устанавливаем в
   удобное место.

   #+ATTR_LATEX: :scale 1
   [[./screenshots/emacs-00.png]]
   #+ATTR_LATEX: :scale 1
   [[./screenshots/emacs-01.png]]

** Устанавливаем Org-Note

   Переходим в репозиторий [[https://github.com/vaddson/org-note][org-note]] и читаем инструкцию до пункта 3
   (включительно).  Команду клонирования репозитория выполняем в окне
   msys2.

   Теперь начинается интересное.

   Домашняя папка для Emacs в Windows отличается от домашней папки
   пользователя.

   Теоретически, можно перенастроить домашнюю папку emacs, чтобы она
   смотрела туда, куда ставится конфигурация org-note, но я не
   разобрался, как заставить emacs смотреть во все нужные конфиги
   сразу.

   Да и не нужно это баловство. Пользовательская папка в Windows и
   так собирает в себя всё возможное барахло - не будем продолжать эту
   традицию.

   Вместо этого, мы перенаправим скрипт установки org-note в нужное
   место. Для этого перед выполнением необходимо прописать переменную
   окружения.

   Выполняем команду по прежнему в терминале msys2.
   #+name: org-note install
   #+begin_src bash
HOME=$APPDATA ./org-note/install
   #+end_src

   После завершения, можно закрыть окно msys2 и двигаться по
   инструкции дальше, то есть, запустить Emacs.

* Особенности

  + На приветственном экране вас должен ждать единорог. Просто так он
    не появится, потому что путь до изображения будет содержать разные
    разделители. Это можно поправить в конфиге, если у вас хватит
    смелости в него залезть.  Вообще, Emacs умеет нормализовать пути,
    но я не уверен куда нужно лезть, чтобы автоматизировать

  + Многие сочетания клавиш при включенной русской раскладке работать
    не будут. Например, нажатие ~Alt+Enter~ (~M-RET~ в терминологии
    Emacs) не будет создавать новые заголовки и элементы
    списка. Пользуйтесь командой ~Ctrl+c d~ (~C-c d~ в терминологии
    Emacs) для переключения раскладки внутри приложения. Учитывайте,
    что такое переключение раскладки не всегда будет работать
    корректно при использовании специальных символов

